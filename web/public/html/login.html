<html>
  <head>
    <meta charset="utf-8" />
    <title>login</title>
    <style></style>
  </head>
  <body>
    <div>
      <input type="text" id="user-id" />
    </div>
    <div>
      <input type="password" id="user-pw" />
    </div>
    <div>
      <button id="login-btn">login</button>
    </div>

    <script>
      function send_get_request(uri, func, func_timeout) {
        var request = new XMLHttpRequest()
        request.open('GET', uri)

        if (func_timeout) {
          request.timeout = 5000
          request.addEventListener('timeout', func_timeout)
        }

        request.addEventListener('readystatechange', function(e) {
          if (this.readyState === 4) {
            if (this.status === 200) {
              var data = JSON.parse(this.responseText)
              if (func) {
                func(data)
              }
            } else {
              alert(this.responseText)
            }
          }
        })

        request.send()
      }

      function send_post_request(uri, data_hash, func, func_timeout) {
        var form_data = new FormData()
        var request = new XMLHttpRequest()
        request.open('POST', uri)

        if (func_timeout) {
          request.timeout = 5000
          request.addEventListener('timeout', func_timeout)
        }

        if (uri !== '/upload') {
          request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')
        } else {
          request.setRequestHeader('Content-type', '')
          Object.keys(data_hash).forEach(key => {
            form_data.append(key, data_hash[key])
          })
        }

        request.addEventListener('readystatechange', function(e) {
          if (this.readyState === 4) {
            if (this.status === 200) {
              var data = JSON.parse(this.responseText)
              if (func) {
                func(data)
              }
            } else {
              alert(this.responseText)
            }
          }
        })

        request.send(form_data)
      }

      const userId = document.getElementById('user-id')
      const userPw = document.getElementById('user-pw')
      const loginBtn = document.getElementById('login-btn')

      loginBtn.addEventListener('click', e => {
        const id = userId.value
        const pw = userPw.value
        const data_hash = {
          id: id,
          pw: pw
        }

        send_post_request('', data_hash)
      })
    </script>
  </body>
</html>
